# Laboratorio 03-C: "Volúmenes"
 
# Este laboratorio repasaremos cómo usar volúmenes para conseguir
# persistencia en el sistema de archivos del contenedor. También pueden
# ser usados para pasar configuraciones en tiempo de inicio del contenedor.

# Requisitos:
#   Una máquina virtual con Ubuntu 20.04 LTS a la que poder hacer ssh.
#   Tener instalado Docker-ce en dicha máquina virtual.

#####################################################
# Ejercicio 1: Publicar aplicación en el contenedor #
#####################################################

# Vamos a crear una aplicación web elemental en un archivo html. Presentaremos este
# archivo al contenedor a través de un volumen. Cuando actualicemos la aplicación, el
# contenedor verá el archivo actualizado.
#
# Cambiamos al directorio de trabajo

cd ~/k8s_desarrolladores/03/volumen

# En el directorio existen dos archivos de configuración de nginx:
# 'nginx.conf' y 'global.conf'.
#
# Comprobemos el contenido de cada uno.

code nginx.conf

# Este archivo configura a 'nginx' para que se inicie solo con llamar a su ejecutable,
# sin necesidad de establecer parámetros ('-g daemon off;').
#
# Una vez estudiado, lo cerramos sin modificar.


# En siguiente archivo 'global.conf' tiene una configuración importante para entender el 
# laboratorio. Lo editamos con el siguiente comando:

code global.conf


# Línea 5: que tiene este valor: '/var/www/html/website;' indica el directorio donde vamos a
# a incluir el archivo (index.html) de la aplicación. Esto es importante porque posteriormente
# usaremos un volumen que va a hacer referencia a esa ruta.

# El archivo 'Dockerfile' instala nginx y copia los archivos de configuración a la imagen de 
# contenedor. Editamos el archivo.

code Dockerfile

# El contenido del archivo es el siguiente:
#
# Línea 1:      Usamos una imagen bade de Ubuntu 16.04
#
# Línea 2:      Se actualiza el repositorio de paquetes y se instala nginx.
#
# Línea 3:      Creamos la carpeta de la aplicación en la ruta '/var/www/html/website'.
#               Será dentro de esa carpeta 'website' donde coloquemos el archivo de la
#               aplicación 'index.html' a través de un volumen.
# 
# Líneas 4 y 5: Se copian los archivos de configuración 'global.conf' y 'nginx.conf' desde
#               el directorio de trabajo al sistema de archivos de la imagen de contenedor.
#               Cuando se inicie nginx, leerá estos archivos.
#
# Línea 6:      Se abre el puerto 80 en el contenedor.

# Cerramos el arhivo sin modificarlo y procedemos a compilar la imagen con el siguiente comando:

sudo docker image build -t antsala/nginx .




